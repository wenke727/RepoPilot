# CLAUDE.md

> Claude Code å·¥ä½œè§„èŒƒ & å¤šå®ä¾‹å¹¶è¡Œå¼€å‘çº¦å®š
> ç›®æ ‡ï¼š**ç¨³å®š / å¯æ¢å¤ / å¯å¹¶è¡Œ / å¯æ²‰æ·€ç»éªŒ**

---

## ä¸€ã€ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸï¼ˆTask Lifecycleï¼‰

### 1. é¢†å–ä»»åŠ¡ï¼ˆåŸå­æ“ä½œï¼‰

* ä» `data/dev-tasks.json` è·å–ä»»åŠ¡
* å¿…é¡»æ˜¯ **åŸå­é¢†å–**ï¼Œé˜²æ­¢å¹¶å‘é‡å¤æ‰§è¡Œ

---

### 2. åˆ›å»ºå·¥ä½œåŒºï¼ˆGit Worktreeï¼‰

```bash
git worktree add -b task/xxx ../voice-notes-worktrees/task-xxx
```

**å·¥ä½œåŒºçº¦å®šï¼š**

* åˆ›å»ºéš”ç¦»çš„ `data/` ç›®å½•ï¼ˆå®éªŒæ•°æ®ï¼Œä»…æœ¬å®ä¾‹ä½¿ç”¨ï¼‰

* å…±äº«æ–‡ä»¶ï¼ˆä½¿ç”¨ symlinkï¼‰ï¼š

  * `dev-tasks.json`ï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰
  * `dev-task.lock`ï¼ˆæ–‡ä»¶é”ï¼‰
  * `api-key.json`ï¼ˆAPI å¯†é’¥ï¼‰

* `node_modules/` å…è®¸ symlinkï¼ˆåŠ é€Ÿå¯åŠ¨ï¼‰

* âš ï¸ **ç¦æ­¢ symlinkï¼š**

  * `PROGRESS.md`ï¼ˆå¿…é¡»ç›´æ¥å†™ä¸»ä»“åº“ï¼‰

* ä¸ºæ¯ä¸ª worktree åˆ†é… **ä¸“å±ç«¯å£**

---

### 3. å®ç°åŠŸèƒ½

* Claude Code **åªåœ¨å½“å‰ worktree å†…å·¥ä½œ**
* ä¸å…è®¸è·¨ worktree ä¿®æ”¹æ–‡ä»¶

---

### 4. æäº¤ä»£ç ï¼ˆTask Branchï¼‰

```bash
git commit
```

* åªåœ¨ `task/xxx` åˆ†æ”¯æäº¤

---

### 5. Merge + æµ‹è¯•

```bash
git fetch origin
git merge origin/main
npm test
```

* å¿…é¡»æµ‹è¯•é€šè¿‡

---

### 6. è‡ªåŠ¨åˆå¹¶åˆ° main

```bash
git fetch origin main
git rebase origin/main
```

* å¦‚ rebase å¤±è´¥ï¼Œè¿›å…¥ã€å†²çªå¤„ç†æµç¨‹ã€‘

æˆåŠŸåï¼š

```bash
git merge main task-xxx
git push origin main
```

* è‹¥å¤±è´¥ï¼Œ**å›é€€åˆ°æ­¥éª¤ 5**

---

### 7. æ ‡è®°å®Œæˆï¼ˆå¿…é¡»åœ¨æ¸…ç†å‰ï¼‰

* æ›´æ–° `dev-tasks.json`
* é˜²æ­¢è¿›ç¨‹è¢«æ€å¯¼è‡´ä»»åŠ¡çŠ¶æ€ä¸¢å¤±

---

### 8. æ¸…ç†

```bash
git worktree remove
```

* åˆ é™¤æœ¬åœ° task åˆ†æ”¯
* åˆ é™¤è¿œç¨‹ task åˆ†æ”¯
* é‡å¯ dev server

---

### 9. ç»éªŒæ²‰æ·€ï¼ˆå¯é€‰ä½†å¼ºçƒˆå»ºè®®ï¼‰

* åœ¨ `PROGRESS.md` ä¸­è®°å½•ç»éªŒ
* å³ä½¿è¿›ç¨‹è¢«æ€ï¼Œä¹Ÿ **ä¸å½±å“ä»»åŠ¡çŠ¶æ€**

---

## äºŒã€å¤šå®ä¾‹å¹¶è¡Œå¼€å‘ï¼ˆGit Worktreeï¼‰

### æ¶æ„è¯´æ˜

* æ”¯æŒå¤šä¸ª Claude Code å®ä¾‹å¹¶è¡Œå·¥ä½œ
* **æ¯ä¸ªå®ä¾‹ = ç‹¬ç«‹ worktree + ç‹¬ç«‹ç«¯å£ + ç‹¬ç«‹ data/**

```txt
å¹¶è¡Œå¼€å‘å·¥ä½œæµ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Worker 1      â”‚   â”‚ Worker 2      â”‚   â”‚ Worker 3      â”‚
â”‚ port: 5200    â”‚   â”‚ port: 5201    â”‚   â”‚ port: 5202    â”‚
â”‚ worktree      â”‚   â”‚ worktree      â”‚   â”‚ worktree      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                   â”‚
      data/               data/               data/
 (éš”ç¦»çš„å®éªŒæ•°æ®)
```

### å…±äº«æ–‡ä»¶ï¼ˆsymlinkï¼‰

* `dev-tasks.json`
* `dev-task.lock`
* `api-key.json`

### âŒ ç¦æ­¢ symlink

* `PROGRESS.md`

  > å¿…é¡»ä½¿ç”¨ `git -C <repo>` ç›´æ¥ä¿®æ”¹ä¸»ä»“åº“æ–‡ä»¶

---

## ä¸‰ã€å†²çªå¤„ç†

### Rebase å¤±è´¥å¤„ç†æµç¨‹

1. å¦‚æœæ˜¯ `unstaged changes`
   * å…ˆ `git commit` æˆ– `git stash`

2. å¦‚æœæœ‰ merge conflictsï¼š

   ```bash
   git status
   ```

   * é˜…è¯»å†²çªå†…å®¹ï¼Œç†è§£åŒæ–¹ä¿®æ”¹æ„å›¾
   * æ‰‹åŠ¨è§£å†³ï¼ˆä¿ç•™æ­£ç¡®é€»è¾‘ï¼‰

   ```bash
   git add <resolved-files>
   git rebase --continue
   ```

3. é‡å¤ç›´åˆ° rebase å®Œæˆ

---

### æµ‹è¯•å¤±è´¥å¤„ç†æµç¨‹

1. è¿è¡Œæµ‹è¯•ï¼š

   ```bash
   npm test
   ```

2. åˆ†æå¤±è´¥åŸå› 
3. ä¿®å¤ä»£ç 
4. é‡æ–°æµ‹è¯•
5. æäº¤ä¿®å¤ï¼š

   ```bash
   git commit -m "fix: ..."
   ```

---

### ğŸš« ä¸è¦æ”¾å¼ƒ

* rebase / test å¤±è´¥ **å¿…é¡»ä¿®å¥½**
* ä¸èƒ½å› ä¸ºå¤±è´¥å°±æ ‡è®°ä»»åŠ¡å¤±è´¥

---

## å››ã€ç»éªŒæ•™è®­æ²‰æ·€ï¼ˆPROGRESS.mdï¼‰

æ¯æ¬¡ **é‡åˆ°é—®é¢˜ / å®Œæˆé‡è¦æ”¹åŠ¨** åï¼Œå¿…é¡»è®°å½•ï¼š

* é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜
* å¦‚ä½•è§£å†³çš„
* ä»¥åå¦‚ä½•é¿å…
* **å¿…é¡»é™„ä¸Š git commit ID**

ğŸ“Œ **åŒæ ·çš„é—®é¢˜ä¸è¦çŠ¯ä¸¤æ¬¡**

---

> This file defines how Claude Code works.
> Stability > Speed. Parallelism > Chaos.
